<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>InterCrypto DAPP</title>

    <!-- Bootstrap -->
    <link href="lib/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="lib/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Brand</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li>
            <li><a href="#">Link</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Separated link</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
          <form class="navbar-form navbar-left">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Link</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Separated link</a></li>
              </ul>
            </li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    <p>
      MENU HEADER: dapp, about
      <br>
      Checkout Contract on <a href="https://rinkeby.etherscan.io/address/0x248075Bd51aAD583e9F5AfDbee3D306B628E6435">Etherscan</a>
    </p>
    <div id="dapp" class="container-fluid">
      Message to say that all blockchain interactions are run client-side only
      <fieldset>
        <label> Ether:
          <input type="text" id="ic_amount" value="0.01"></input>
        </label>
        <label> Other blockchain:
          <select id="ic_symbol">
            <option>Bitcoin</option>
            <option selected="selected">Litecoin</option>
            <option>Ethereum Classic</option>
            <option>Dash</option>
          </select>
        </label>
        <label> Other blockchain address:
          <input type="text" id="ic_address" value="LbZcDdMeP96ko85H21TQii98YFF9RgZg3D"></input>
        </label>
        <button onclick="ic_sendToOtherBlockchain()">Send to other blockchain</button>
        <div id="ic_sendToOtherBlockchain_response"></div>
      </fieldset>

      <fieldset>
        <button onclick="ic_getInterCryptoPrice()">Get price of InterCrypto transaction</button>
        <div id="ic_getInterCryptoPrice_response"></div>
      </fieldset>

      <fieldset>
        <label> Ether:
          <input type="text" id="transaction_amount"></input>
        </label>
        <button onclick="transaction_send()">Donate to the Author</button>
        <div id="transaction_response"></div>
      </fieldset>
    </div>


    <div id="about">
      about the InterCrypto dapp
    </div>

    <br>
    Bootstrap <a href="https://getbootstrap.com/components/">components</a>

    <script>
      const contractABI = JSON.parse('[{"constant":false,"inputs":[{"name":"myid","type":"bytes32"},{"name":"result","type":"string"}],"name":"__callback","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getInterCryptoPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"update_oracalize","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"_coinSymbol","type":"string"},{"name":"_toAddress","type":"string"}],"name":"sendToOtherBlockchain","outputs":[{"name":"transactionID","type":"uint256"}],"payable":true,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"transactionID","type":"uint256"}],"name":"TransactionSubmitted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"transactionID","type":"uint256"},{"indexed":false,"name":"depositAddress","type":"address"}],"name":"TransactionMade","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"transactionID","type":"uint256"},{"indexed":false,"name":"reason","type":"string"}],"name":"TransactionAborted","type":"event"}]');
      const rinkeby_address = '0x248075bd51aad583e9f5afdbee3d306b628e6435';

      var contractAddress;
      var myContract;
      var InterCrypto;

      // MetaMask injects the web3 library for us.
      window.onload = function() {
        if (typeof web3 === 'undefined') {
          document.getElementById('dapp').innerHTML = 'You need <a href="https://metamask.io/">MetaMask</a> browser plugin to run this example'
        }
        else {
          // TODO: Check what blockchain is being run and set contract address accordingly.
          // TODO: Show message if that blockchain is not supported...

          contractAddress = rinkeby_address;
          myContract = web3.eth.contract(contractABI);
          InterCrypto = myContract.at(contractAddress);
          // TODO: Check that InterCrypto is defined, else show message
        }
      }

      // DELETE ME AT END
      function transaction_send() {
        web3.eth.sendTransaction({
          from: web3.eth.coinbase,
          to: '0xE767aEB31dAAF66366999F72FB5De2CEEA76c277',
          value: web3.toWei(document.getElementById("transaction_amount").value, 'ether')
        }, function(error, result) {
          if (!error) {
            document.getElementById('transaction_response').innerHTML = 'Success: <a href="https://testnet.etherscan.io/tx/' + result + '"> View Transaction </a>'
          } else {
            document.getElementById('transaction_response').innerHTML = '<pre>' + error + '</pre>'
          }
        })
      }


      function ic_sendToOtherBlockchain() {
        var amountToSend = web3.toWei(document.getElementById("ic_amount").value, 'ether')
        var symbol;
        // console.log('ic_symbol')
        switch (document.getElementById('ic_symbol').value) {
          case 'Bitcoin':
            symbol = 'btc';
            break;
          case 'Litecoin':
            symbol = 'ltc';
            break;
          case 'Ethereum Classic':
            symbol = 'etc';
            break;
          case 'Dash':
            symbol = 'xxxxxx';
            break;
          default:
            throw "Currency symbol not found"
        }
        var address = document.getElementById('ic_address').value;

        InterCrypto.sendToOtherBlockchain(symbol, address, {value: amountToSend}, (error, result) => {
          document.getElementById('ic_sendToOtherBlockchain_response').innerHTML = result;
        })

        // document.getElementById('ic_sendToOtherBlockchain_response').innerHTML = contractABI + "<br>" + contractAddress;
      }

      function ic_getInterCryptoPrice() {
        InterCrypto.getInterCryptoPrice((error, result) => {
          document.getElementById('ic_getInterCryptoPrice_response').innerHTML = "Price: " + result + " Wei";
        });
      }
    </script>
  </body>
